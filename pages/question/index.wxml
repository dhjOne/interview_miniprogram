<!-- pages/question/list/index.wxml -->
<nav nav-type="title" title="{{categoryName || '题库列表'}}" />

<view class="question-list-container">
  <!-- 搜索区域 -->
  <view class="search-section">
    <t-search
      value="{{searchValue}}"
      placeholder="搜索题目..."
      bind:change="onSearchChange"
      bind:search="onSearch"
      shape="round"
    ></t-search>
  </view>

  <!-- 筛选条件 -->
  <view class="filter-section">
    <view class="filter-tags">
      <t-tag
        wx:for="{{filterTags}}"
        wx:key="value"
        theme="{{activeFilter === item.value ? 'primary' : 'outline'}}"
        bind:click="onFilterChange"
        data-value="{{item.value}}"
      >
        {{item.label}}
      </t-tag>
    </view>
  </view>

  <!-- 题目列表 -->
  <view class="questions-section">
    <!-- 题目列表 -->
    <scroll-view class="questions-scroll" scroll-y="true" bindscroll="onPageScroll">
      <view class="question-list">
        <block wx:for="{{questionList}}" wx:key="id">
          <!-- 添加 bindtap 事件到整个问题项 -->
          <view 
            class="question-item {{item.isCollected ? 'collected' : ''}}"
            bindtap="onQuestionClick"
            data-id="{{item.id}}"
            data-title="{{item.title}}"
          >
            <view class="question-header">
              <view class="question-index">
                <text class="index-number">{{index + 1}}</text>
              </view>
              <view class="question-main">
                <view class="question-title-section">
                  <text class="question-title">{{item.title}}</text>
                  <view class="question-tags">
                    <t-tag
                      wx:if="{{item.difficulty}}"
                      theme="{{getDifficultyTheme(item.difficulty)}}"
                      size="small"
                    >
                      {{getDifficultyText(item.difficulty)}}
                    </t-tag>
                    <t-tag
                      wx:if="{{item.type}}"
                      theme="outline"
                      size="small"
                    >
                      {{item.type}}
                    </t-tag>
                  </view>
                </view>
                <view class="question-meta">
                  <text class="meta-item">
                    <t-icon name="time" size="24rpx"></t-icon>
                    {{item.createTime}}
                  </text>
                  <text class="meta-item">
                    <t-icon name="view" size="24rpx"></t-icon>
                    {{item.viewCount}} 浏览
                  </text>
                  <text class="meta-item">
                    <t-icon name="app" size="24rpx"></t-icon>
                    {{item.commentCount}} 评论
                  </text>
                </view>
              </view>
              <view class="question-actions">
                <!-- 阻止收藏按钮的事件冒泡 -->
                <view catchtap="onCollect" data-id="{{item.id}}">
                  <t-icon
                    name="{{item.isCollected ? 'star-filled' : 'star'}}"
                    size="36rpx"
                    color="{{item.isCollected ? '#ff6b35' : '#999'}}"
                    class="collect-icon"
                  ></t-icon>
                </view>
              </view>
            </view>
            
            <!-- 题目描述（可选，点击展开） -->
            <view wx:if="{{item.description}}" class="question-description">
              <text class="description-text">{{item.description}}</text>
            </view>
          </view>
        </block>
      </view>

      <!-- 加载更多 -->
      <view wx:if="{{hasMore}}" class="load-more">
        <t-loading size="32rpx" text="加载中..." wx:if="{{loading}}" />
        <t-button
          wx:else
          theme="outline"
          size="small"
          bindtap="loadMore"
        >
          加载更多
        </t-button>
      </view>

      <!-- 没有更多数据 -->
      <view wx:if="{{!hasMore && questionList.length > 0}}" class="no-more">
        <text class="no-more-text">没有更多题目了</text>
      </view>

      <!-- 空状态 -->
      <view wx:if="{{questionList.length === 0 && !loading}}" class="empty-state">
        <t-icon name="file" size="120rpx" color="#ccc"></t-icon>
        <text class="empty-text">暂无题目</text>
        <text class="empty-desc">当前分类下还没有题目</text>
        <t-button theme="primary" bindtap="goRelease" class="empty-btn">
          发布题目
        </t-button>
      </view>
    </scroll-view>
  </view>
</view>

<!-- 回到顶部 -->
<view wx:if="{{showBackTop}}" class="back-top" bindtap="scrollToTop">
  <t-icon name="caret-up" size="32rpx" color="#fff"></t-icon>
</view>